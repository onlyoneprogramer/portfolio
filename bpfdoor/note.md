아래는 해당 note.md 파일의 내용을 기반으로 한 논문 형식의 정리입니다. 논문의 전형적인 구조(서론, 관련 연구, 제안 방법, 구현 및 실험, 결론 및 향후 과제)를 따라 작성하였으며, 각 장의 논리적 흐름과 세부 내용을 최대한 충실하게 반영하였습니다.

---

# 하이퍼바이저 기반 BPFdoor 대응 보안 프레임워크 설계 및 구현

## 초록(Abstract)

본 논문은 최근 급증하고 있는 리눅스 커널 레벨 백도어, 특히 eBPF(Berkeley Packet Filter)를 악용하는 BPFdoor 위협에 효과적으로 대응하기 위한 보안 프레임워크를 제안한다. 제안 시스템은 하이퍼바이저 기반 외부 감시(VMI, Virtual Machine Introspection), 커널 무결성 검증, 이중 감시 에이전트, 자동 복구 및 대응 모듈로 구성된다. 실제 구현 및 실험을 통해 높은 탐지율과 낮은 성능 오버헤드, 신속한 대응 속도를 확인하였다. 본 연구는 가상화 환경에서의 차세대 보안 전략을 제시하며, 향후 다양한 환경 및 인공지능 기반의 확장 방안도 논의한다.

---

## 1. 서론 (Introduction)

정보보안의 발전과 함께 악성코드 및 백도어 역시 고도화되고 있다. 특히 리눅스 환경의 고급 위협은 전통적 보안 솔루션으로 탐지하기 어려운 특성을 지닌다. BPFdoor는 eBPF를 악용하여 탐지 회피 및 시스템 통제 능력이 매우 뛰어난 대표적 백도어로, netstat, ps, lsof 등으로는 탐지할 수 없고, 방화벽이나 IDS도 우회한다. 기존의 SELinux, AppArmor, Auditd 같은 LSM 기반 종래 리눅스 보안 구조는 이러한 위협에 근본적으로 취약하다. 단일 Agent 기반 보안 솔루션 또한 공격자가 Agent를 종료하거나 우회하면 무력화되는 한계가 있다.

본 논문은 단일 탐지 방식의 한계를 극복하고, 하이퍼바이저 기반 다계층 보안 아키텍처를 설계하여 BPFdoor와 같은 고급 위협에 효과적으로 대응하는 방법을 제시한다.

---

## 2. 관련 연구 (Related Works)

### 2.1 BPFdoor 백도어 개요 및 동작 방식

BPFdoor는 2022년부터 보안 커뮤니티에서 주목받은 고급 백도어로, 중국계 APT 그룹(Red Menshen 등)에 의해 정부 및 방위 산업체를 타겟으로 사용되었다. 감염 시 리눅스 시스템 백그라운드에서 상주하며, 시스템 호출 hijacking 없이 eBPF를 커널 레벨에 삽입해 동작한다. 기존 백도어와 달리 흔적이 거의 없고, 포트리스닝이나 명령 수신 시에도 외부에서만 활성화되는 반응형 특성을 지닌다.

### 2.2 리눅스 커널 보안 기술의 한계

- **접근 제어 기반(LSM):** SELinux, AppArmor, Smack 등은 커널 객체 접근 제어를 제공하나, eBPF의 삽입과 행위는 제한하지 못한다.
- **로그/감사 기반:** Auditd, Syslog 등은 유저영역 이벤트만 감시해 커널 수준 eBPF 삽입은 탐지 불가.
- **무결성 검증:** Tripwire, IMA/EVM은 파일 변조만 탐지하며, 메모리 내 eBPF 실행은 탐지 불가.

결국 기존 보안 시스템은 BPFdoor가 삽입된 후에는 이를 식별, 차단하는 데 한계가 있다.

### 2.3 eBPF 보안 취약점과 공격 활용 사례

eBPF는 원래 커널 패킷 필터링/성능 분석용이지만, 다음과 같은 공격에 활용된다:
- 커널 내부 코드 실행(권한 우회, arbitrary code execution 가능)
- 흔적이 거의 없음(netfilter, iptables 우회)
- Ring 0 권한 접근 및 다양한 악성 행위(통신 은닉, 정보 유출 등)

실제 사례로 BPFdoor, Loadable BPF Injection, BPF Rootkit 등이 존재한다.

### 2.4 하이퍼바이저 기반 감시 기술

하이퍼바이저(VMM)는 게스트 OS 외부에서 감시 가능하여, 공격자가 루트 권한을 얻어도 감시 우회가 어렵다. 대표 기술로 SecVisor, BitVisor, HelloVisor 등이 있으며, KVM 기반의 VMI(Virtual Machine Introspection), LibVMI, DRAKVUF 등이 활용된다.

### 2.5 이중 에이전트 기반 탐지 및 복구 체계

단일 Agent의 취약성을 극복하기 위해, 서로를 감시·복구하는 이중 Agent 구조가 연구되고 있다(MIT Self-Healing Systems, CMU Dual-Process Watchdog Framework). 본 논문은 agent-main과 agent-shadow로 역할 분리 및 상호 복구를 구현하였다.

---

## 3. 제안하는 방어 프레임워크 설계

### 3.1 설계 철학 및 보안 목표

- **가시성과 외부성:** 내부 탐지 불가한 은닉형 공격 대응 위해 하이퍼바이저 외부 감시 도입
- **이중 감시/무결성 검증:** 두 개의 Agent가 상호 감시·복구
- **행위 기반 이상 탐지:** 시그니처가 아닌 eBPF, 네트워크, 시스템콜 등의 이상행위 기반 탐지
- **자동 복구/격리:** 위협 탐지 시 시스템 자원 격리, 재부팅, 프로세스 복구 등 자동 대응
- **확장성/유연성:** 모듈화 설계로 다양한 환경 확장 지원

### 3.2 전체 시스템 아키텍처 개요

주요 구성 요소:
- 하이퍼바이저 기반 VMI 감시 모듈
- 커널 무결성 검증 모듈
- 이중 감시 에이전트 (Main / Shadow)
- 자동 대응 및 복구 모듈

각 모듈은 RESTful API 또는 공유 메모리로 통신하며, 독립적으로 동작한다.

### 3.3 하이퍼바이저 기반 VMI 감시 모듈

KVM 기반 LibVMI, DRAKVUF를 활용하여 eBPF 관련 시스템콜(bpf, perf_event_open 등), 커널 메모리(eBPF map/object), 프로세스 행위, 포트리스닝 등을 실시간 감시한다. 관리자 VM에서 동작하여 직접 게스트 OS에 접근하지 않는다.

### 3.4 커널 무결성 검증 모듈

게스트 OS 내부에 설치되어 sys_call_table 변조, eBPF hook 포인트, LKM/BPF map object 존재 여부 등을 검사한다. kprobe, ftrace, eBPF verifier 로그를 활용하며, 이상 징후 시 VMI/agent에 신호를 보낸다.

### 3.5 이중 감시 에이전트 (agent-main / agent-shadow)

서로를 모니터링하는 두 개의 데몬 프로세스가 3초마다 heartbeat(PID, 메모리/CPU 사용량 등) 교환, 해시값 비교 등으로 무결성 검증 및 비정상 종료/변조 시 자동 복구 루틴을 실행한다. 네트워크 I/O 분석으로 비정상 소켓 생성, 포트리스닝 등도 탐지한다.

### 3.6 자동 복구 및 대응 모듈

위협 탐지 시, 네트워크 인터페이스 격리, 자동 재부팅, VM 상태 스냅샷, 로그 압축 및 중앙 서버 전송 등의 단계적 대응을 수행한다. 심각도에 따라 대응 레벨을 구분한다.

### 3.7 설계의 차별성 및 기여

- 하이퍼바이저 VMI + Agent 행위분석 결합
- 이중 감시 시스템 도입
- eBPF 구조와 hook 포인트 대상 최적화
- 자동 복구 및 포렌식 연계
- 실제 환경에서의 실용성 검증

---

## 4. 프레임워크 구현 및 실험 결과 분석

### 4.1 실험 및 구현 환경

- **하이퍼바이저:** KVM(QEMU 6.2)
- **VMI 라이브러리:** LibVMI 0.14 + DRAKVUF
- **게스트 OS:** Ubuntu 22.04 LTS, 커널 5.15
- **Agent:** Rust 기반
- **eBPF 백도어:** BPFdoor 변종
- **포렌식:** Volatility3 기반
- **테스트 환경:** Nested Virtualization 활성화 KVM

### 4.2 구현 방식

- **VMI 모듈:** LibVMI로 프로세스 트리, 커널 eBPF 구조, 시스템콜 후킹 등 분석
- **Agent:** /proc/net/tcp, /proc/net/unix 파싱, BPFtrace 활용, heartbeat 교환, sha256 해시 무결성 검증
- **무결성 검증:** kcore와 live memory에서 sys_call_table, nf_hook_ops diff 분석, eBPF verifier 로그 활용
- **자동 대응:** Go 기반, 로그→격리→스냅샷/재부팅 등 단계적 조치

### 4.3 실험 시나리오 및 테스트 케이스

| 테스트케이스 | 내용 |
|:---|:---|
| TC1 | BPFdoor 숨김 포트 리스닝, 외부 접근 시 활성화 |
| TC2 | syscall table 후킹 |
| TC3 | netfilter hook에 eBPF map 연결 |
| TC4 | LKM으로 bpf syscall 감싸기 |
| TC5 | agent-main 강제 종료(공격자 제거 시나리오) |
| TC6 | 하이퍼바이저 접근 로그 위조/은폐 시도 |

### 4.4 실험 결과 및 분석

- **탐지율:** 평균 95% 이상, 모든 시나리오에서 최소 한 개 모듈이 탐지
- **대응 속도:** 이상 탐지→대응 실행 평균 1.2초, 네트워크 격리 800ms, 전체 복구 3.5초
- **성능 오버헤드:** CPU 증가 3.1%, 메모리 72MB, 디스크 I/O 무시 수준
- **실제 악성 샘플 실험:** VMI/무결성 모듈이 커널 함수 테이블 변조, eBPF map 연결 등 탐지 성공

### 4.5 실험 의의 및 한계

- **의의:** VMI와 Agent 결합이 효과적, eBPF 백도어에 대한 실질적 모델 제시
- **한계:** KVM 의존, 최신 공격 기법 일부 미포함, 하드웨어 스펙 의존성

---

## 5. 결론 및 향후 과제

### 5.1 결론

하이퍼바이저 기반 외부 감시와 내부 Agent, 커널 무결성 검증, 자동 복구 모듈을 결합한 통합 프레임워크는 BPFdoor와 같은 고급 eBPF 기반 백도어에 대해 높은 탐지율과 빠른 대응, 낮은 오버헤드의 성능을 보였다. 가시성, 자동화, 다계층 방어라는 측면에서 차세대 리눅스 보안 전략의 패러다임을 제시한다.

### 5.2 연구 의의 및 기여

- 가상화 기반 커널 레벨 백도어 탐지·방어 최초 통합 프레임워크 제안
- 이중 에이전트 구조로 정교한 모니터링·신속 대응 구현
- VMI와 LSM 결합으로 메모리 무결성 및 정책 기반 보안 강화
- 실제 공격 적용과 성능 평가로 실용성 입증

### 5.3 한계점

- 가상화 기반 시스템에 한정, 비가상화 환경에서는 동일 효과 보장 어려움
- BPFdoor 변종 및 최신 공격 기법 완전 대응은 미흡
- 자동 격리/재부팅 메커니즘의 시스템 가용성 리스크
- 다양한 실제 운영 환경/하드웨어 테스트 부족

### 5.4 향후 연구 과제

- 비가상화 환경 대응 방안 연구
- 인공지능 기반 이상 행위 탐지 통합
- 자동 복구/대응 메커니즘의 신뢰성·무중단성 강화
- 다양한 하이퍼바이저, 클라우드/컨테이너 환경 적용
- 실시간 모니터링/시각화 도구 개발
- 사용자 맞춤형 보안 정책 및 지속적 학습 시스템 연구

### 5.5 기대 효과 및 활용 방안

제안 프레임워크는 커널 레벨 위협에 효과적으로 대응할 수 있어, 금융·통신 등 중요 인프라 보호와 차세대 통합 보안 플랫폼 구축에 기여할 것으로 기대된다.

---